<!doctype html>
<meta charset="utf-8">
<title>Bunya-ONT-Gen â€¢ Results</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
  :root{
    --fg:#0b1220; --muted:#5b667a; --link:#1f6feb; --bg:#f7f9fc; --card:#ffffff; --border:#e5e9f2;
  }
  html[data-theme="dark"]{
    --fg:#e6e6ea; --muted:#9aa3b2; --link:#7aa2ff; --bg:#0d1117; --card:#161b22; --border:#2b3138;
  }
  *{box-sizing:border-box}
  body{
    font: 17px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial,"Noto Sans";
    margin:0; color:var(--fg); background:var(--bg)
  }
  header{
    padding:2.5rem 1.25rem 1.25rem; max-width:980px; margin:0 auto;
    display:flex; align-items:flex-start; gap:14px
  }
  h1{ margin:0 0 .35rem; font-size:1.95rem }
  .muted{ color:var(--muted); font-size:1rem }
  .spacer{ flex:1 }
  .toggle{
    border:1px solid var(--border); background:var(--card); color:var(--fg);
    padding:.6rem .9rem; border-radius:999px; cursor:pointer; font-size:0.9rem
  }
  .toggle:hover{ filter:brightness(1.03) }
  main{ max-width:980px; margin:0 auto; padding:0 1.25rem 3.25rem }
  section{ margin-top:1.35rem }
  .grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:16px; margin-top:.6rem }
  .card{ background:var(--card); border:1px solid var(--border); border-radius:16px; padding:16px 16px 14px }
  .card h3{ margin:0 0 8px; font-size:1.15rem }
  .card p{ margin:0 0 10px; color:var(--muted); font-size:.98rem }
  a{ color:var(--link); text-decoration:none }
  a:hover{ text-decoration:underline }
  ul{ margin:.6rem 0 0 1.1rem }
  .small{ font-size:1rem; font-weight:600 }
  @media (min-width:1200px){
    h1{ font-size:2.1rem }
    .card h3{ font-size:1.2rem }
  }
</style>

<header>
  <div>
    <h1>Bunya-ONT-Gen results</h1>
    <div class="muted">Static outputs published via GitHub Pages</div>
  </div>
  <div class="spacer"></div>
  <button id="themeToggle" class="toggle" aria-pressed="false" title="Toggle light/dark mode">ðŸŒ™ Dark</button>
</header>

<main>
  <!-- Quick links -->
  <section>
    <h2 class="small">Key reports</h2>
    <div class="grid">
      <div class="card">
        <h3>MultiQC</h3>
        <p>Run-wide QC summary.</p>
        <!-- HTML renders natively; open as-is -->
        <a href="multiqc/multiqc_report.html">Open MultiQC report</a>
      </div>
      <div class="card">
        <h3>Krona charts</h3>
        <p>Interactive taxonomic composition.</p>
        <ul>
          <!-- HTML renders natively; open as-is -->
          <li><a href="krona/SRR34843736.krona.html">SRR34843736.krona.html</a></li>
          <li><a href="krona/SRR34843737.krona.html">SRR34843737.krona.html</a></li>
          <li><a href="krona/SRR34843738.krona.html">SRR34843738.krona.html</a></li>
          <li><a href="krona/SRR34843739.krona.html">SRR34843739.krona.html</a></li>
        </ul>
      </div>
      <div class="card">
        <h3>Phylogeny</h3>
        <p>Trees and IQ-TREE outputs.</p>
        <ul>
          <!-- Text-like files use inline viewer -->
          <li><a class="inline-view" href="phylogeny/concat.contree">concat.contree</a></li>
          <li><a class="inline-view" href="phylogeny/concat.iqtree">concat.iqtree</a></li>
          <li><a class="inline-view" href="phylogeny/concat.treefile">concat.treefile</a></li>
          <!-- Images render natively -->
          <li><a href="phylogenetic/Phylogenetic_tree.jpg" target="_blank" rel="noopener">Phylogenetic_tree.jpg</a></li>
        </ul>
      </div>
    </div>
  </section>

  <!-- All artifacts -->
  <section>
    <h2 class="small">Per-sample & summarized outputs</h2>
    <div class="grid">
      <div class="card">
        <h3>Variants (VCF)</h3>
        <ul>
          <li><a class="inline-view" href="variants/SRR34843736.vcf">SRR34843736.vcf</a></li>
          <li><a class="inline-view" href="variants/SRR34843737.vcf">SRR34843737.vcf</a></li>
          <li><a class="inline-view" href="variants/SRR34843738.vcf">SRR34843738.vcf</a></li>
          <li><a class="inline-view" href="variants/SRR34843739.vcf">SRR34843739.vcf</a></li>
        </ul>
      </div>

      <div class="card">
        <h3>Assemblies (FASTA)</h3>
        <ul>
          <li><a class="inline-view" href="assemblies/SRR34843736.scaffolds.fasta">SRR34843736.scaffolds.fasta</a></li>
          <li><a class="inline-view" href="assemblies/SRR34843737.scaffolds.fasta">SRR34843737.scaffolds.fasta</a></li>
          <li><a class="inline-view" href="assemblies/SRR34843738.scaffolds.fasta">SRR34843738.scaffolds.fasta</a></li>
          <li><a class="inline-view" href="assemblies/SRR34843739.scaffolds.fasta">SRR34843739.scaffolds.fasta</a></li>
        </ul>
      </div>

      <div class="card">
        <h3>Species abundance (CSV)</h3>
        <ul>
          <li><a class="inline-view" href="summary/SRR34843736.clean_species_abundance_summary.csv">SRR34843736â€¦abundance_summary.csv</a></li>
          <li><a class="inline-view" href="summary/SRR34843737.clean_species_abundance_summary.csv">SRR34843737â€¦abundance_summary.csv</a></li>
          <li><a class="inline-view" href="summary/SRR34843738.clean_species_abundance_summary.csv">SRR34843738â€¦abundance_summary.csv</a></li>
          <li><a class="inline-view" href="summary/SRR34843739.clean_species_abundance_summary.csv">SRR34843739â€¦abundance_summary.csv</a></li>
        </ul>
      </div>

      <div class="card">
        <h3>Run report (TSV)</h3>
        <ul>
          <li><a class="inline-view" href="report/assembly_stats_summary.tsv">assembly_stats_summary.tsv</a></li>
          <li><a class="inline-view" href="report/mapped_reads_summary.tsv">mapped_reads_summary.tsv</a></li>
        </ul>
      </div>
    </div>
  </section>
</main>

<script>
  (function () {
    const btn = document.getElementById('themeToggle');
    const KEY = 'bunya-theme';
    const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    const saved = localStorage.getItem(KEY);
    const initial = saved || (prefersDark ? 'dark' : 'light');
    function apply(theme){
      document.documentElement.setAttribute('data-theme', theme);
      localStorage.setItem(KEY, theme);
      btn.setAttribute('aria-pressed', theme === 'dark');
      btn.textContent = theme === 'dark' ? 'ðŸŒž Light' : 'ðŸŒ™ Dark';
    }
    apply(initial);
    btn.addEventListener('click', () => {
      const next = (document.documentElement.getAttribute('data-theme') === 'dark') ? 'light' : 'dark';
      apply(next);
    });
  })();

  // Inline viewer: open text-based results in a new tab instead of downloading
  (function () {
    const TEXT_EXT = new Set([
      'vcf','fasta','fa','fna','faa','csv','tsv','txt','contree','iqtree','treefile'
    ]);

    function getExt(url){
      const q = url.split('?')[0].split('#')[0];
      const idx = q.lastIndexOf('.');
      return idx >= 0 ? q.slice(idx+1).toLowerCase() : '';
    }

    async function openInline(href){
      const ext = getExt(href);
      const isCsv = ext === 'csv';
      const mime = isCsv ? 'text/csv' : 'text/plain';

      try {
        const resp = await fetch(href, { credentials: 'same-origin' });
        if (!resp.ok) throw new Error('HTTP ' + resp.status);
        const text = await resp.text();
        const blob = new Blob([text], { type: mime + ';charset=utf-8' });
        const url = URL.createObjectURL(blob);
        window.open(url, '_blank', 'noopener');
      } catch (e) {
        // Fallback: let the browser handle the URL (might download)
        window.location.href = href;
      }
    }

    document.addEventListener('click', function (e) {
      const a = e.target.closest('a.inline-view');
      if (!a) return;
      const ext = getExt(a.getAttribute('href') || '');
      if (!TEXT_EXT.has(ext)) return; // safety guard
      e.preventDefault();
      openInline(a.href);
    });
  })();
</script>
